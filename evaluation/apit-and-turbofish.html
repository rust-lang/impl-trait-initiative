<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>APIT and Turbofish - Impl trait initiative</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../index.html">üëã Welcome</a></li><li class="chapter-item "><a href="../CHARTER.html">üìú Charter</a></li><li class="chapter-item "><a href="../updates.html">‚úèÔ∏è Updates</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/2021-oct.html">2021-Oct</a></li></ol></li><li class="chapter-item expanded "><a href="../evaluation.html">üî¨ Evaluation</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../evaluation/apit-and-turbofish.html" class="active">APIT and Turbofish</a></li></ol></li><li class="chapter-item "><a href="../explainer.html">üìö Explainer</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../explainer/apit.html">Impl trait in argument types</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../explainer/apit_turbofish.html">Turbofish</a></li><li class="chapter-item "><a href="../explainer/apit_traits.html">Traits and impls</a></li></ol></li><li class="chapter-item "><a href="../explainer/tait.html">Impl trait in type aliases</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../explainer/tait_infer.html">Inferring the hidden type</a></li><li class="chapter-item "><a href="../explainer/tait_ref.html">Referencing from outside the module</a></li><li class="chapter-item "><a href="../explainer/tait_generics.html">Generic parameters</a></li></ol></li><li class="chapter-item "><a href="../explainer/rpit.html">Impl trait in return types</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../explainer/rpit_capture.html">Generic parameter capture</a></li><li class="chapter-item "><a href="../explainer/rpit_names.html">Naming impl trait in return types</a></li></ol></li><li class="chapter-item "><a href="../explainer/rpit_trait.html">Return types in trait definitions</a></li><li class="chapter-item "><a href="../explainer/lbit.html">Impl trait in let bindings</a></li><li class="chapter-item "><a href="../explainer/auto_trait.html">Auto traits and impl trait</a></li><li class="chapter-item "><a href="../explainer/inference.html">Appendix A: Inference details</a></li><li class="chapter-item "><a href="../explainer/where_ok.html">Appendix B: Where can impl trait be used</a></li><li class="chapter-item "><a href="../explainer/where_not_ok.html">Appendix C: Where can impl trait NOT be used</a></li><li class="chapter-item "><a href="../explainer/glossary.html">Appendix D: Glossary</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../explainer/glossary/defining_scope.html">Defining scope</a></li><li class="chapter-item "><a href="../explainer/glossary/hidden_type.html">Hidden type</a></li><li class="chapter-item "><a href="../explainer/glossary/input_impl_trait.html">Input impl trait</a></li><li class="chapter-item "><a href="../explainer/glossary/output_impl_trait.html">Output impl trait</a></li></ol></li></ol></li><li class="chapter-item "><a href="../RFC.html">‚ú® RFCs</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../RFCs/rpit-in-traits.html">Return position impl Trait in traits</a></li><li class="chapter-item "><a href="../RFCs/named-function-types.html">Function types and impl trait</a></li></ol></li><li class="chapter-item "><a href="../FAQ.html">üòï FAQ</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Impl trait initiative</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/impl-trait" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="apit-and-turbofish"><a class="header" href="#apit-and-turbofish">APIT and Turbofish</a></h1>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p><code>impl Trait</code> in argument position <a href="../explainer/apit.html">introduces a new generic parameter to the function</a>:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn collect_to_vec&lt;T&gt;(iter: impl Iterator&lt;Item = T&gt;) -&gt; Vec&lt;T&gt; {
    iter.collect()
}

// is roughly equivalent to:

fn collect_to_vec_desugared&lt;T, I&gt;(iter: I) -&gt; Vec&lt;T&gt;
where
    I: Iterator&lt;Item = T&gt;,
{
    iter.collect()
}
<span class="boring">}
</span></code></pre></pre>
<p>With the desugared version, users can write an expression that manually specifies the values for its type parameters:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let f = collect_to_vec_desugared::&lt;u32, vec::IntoIter&lt;u32&gt;&gt;;
<span class="boring">}
</span></code></pre></pre>
<p>The question addressed here is whether it should be possible to write an equivalent expression for <code>collect_to_vec</code>.</p>
<h2 id="current-behavior"><a class="header" href="#current-behavior">Current behavior</a></h2>
<p>The compiler today prevents the use of turbofish for any function with <a href="../explainer/apit.html">APIT</a>. This is a future compatibility restriction and not a long term plan.</p>
<h2 id="observations"><a class="header" href="#observations">Observations</a></h2>
<h3 id="users-should-not-have-to-acknowledge-impl-trait-during-turbofish-thatd-be-confusing"><a class="header" href="#users-should-not-have-to-acknowledge-impl-trait-during-turbofish-thatd-be-confusing">Users should not <em>have</em> to acknowledge impl Trait during turbofish, that'd be confusing</a></h3>
<p>Today, when using turbofish form, we require that users write a value for <em>all</em> generic type parameters, even if that value is <code>_</code> (we allow lifetime parameters to be elided if the user chooses, and in fact <em>require</em> them to be elided in some cases). Therefore, it would be an error to write <code>collect_to_vec_desugared::&lt;u32&gt;(vec.into_iter())</code>. It is allowed to write <code>collect_to_vec_desugared::&lt;u32, _&gt;(vec.into_iter())</code>, however, and thus to lean on type inference for one parameter.</p>
<p>While <a href="../explainer/apit.html">APIT</a> is &quot;roughly equivalent&quot; to a new generic parameter, this parameter is not listed explicitly in the list of generics. Therefore, it would likely be surprising for users to get an error for not giving it a value. This argues that <code>collect_to_vec::&lt;u32&gt;(vec.into_iter())</code> should be accepted.</p>
<h3 id="if-we-wish-to-allow-turbofish-to-specify-the-value-for-an-impl-trait-we-would-need-to-linearize-the-list"><a class="header" href="#if-we-wish-to-allow-turbofish-to-specify-the-value-for-an-impl-trait-we-would-need-to-linearize-the-list">If we wish to allow turbofish to specify the value for an impl Trait, we would need to linearize the list</a></h3>
<p>Furthermore, if we wished to extend <code>impl Trait</code> parameters into the list of type parameters, we would have to come up with an ordering. Presumably it would be &quot;left to right&quot; as they are written within the arguments.</p>
<h3 id="some-type-parameters-are-given-explicit-values-more-often-than-others-and-rust-doesnt-let-one-make-that-distinction"><a class="header" href="#some-type-parameters-are-given-explicit-values-more-often-than-others-and-rust-doesnt-let-one-make-that-distinction">Some type parameters are given explicit values more often than others and Rust doesn't let one make that distinction</a></h3>
<p>It sometimes happens that functions have some type parameters which are useful (even mandatory) to specify, and others which are not. This usually happens when some type parameters appear in the argument list, and hence can be inferred from the call arguments, but others either do not appear anywhere or appear only in the return type. Example: </p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn log_the_things&lt;D: DebugLog&gt;(strings: impl IntoIterator&lt;Item = String&gt;) {
    for s in strings {
        D::log_str(s);
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>Here, it would be common for users to wish to write something like <code>log_the_things::&lt;SomeLoggerType&gt;(some_vector)</code>, where the type <code>D</code> is manually specified but the value of the <code>impl IntoIterator</code> is inferred from the argument. Without using <code>impl Trait</code>, this would have to be written <code>log_the_things::&lt;SomeLoggerType, _&gt;(...)</code>.</p>
<h3 id="you-sometimes-want-to-get-a-function-type-without-calling-it"><a class="header" href="#you-sometimes-want-to-get-a-function-type-without-calling-it">You sometimes want to get a function type without calling it</a></h3>
<p>In all the examples so far, we have assumed that it was possible to infer the value of an <code>impl Trait</code> argument from the arguments that were supplied. But that might not always be true. Consider this rather artificial example:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo&lt;T&gt; {
    t: T
}

fn test_fn(x: impl Iterator) {
    
}

fn make() -&gt; Foo&lt;impl Debug&gt; {
    Foo { x: test_fn }
}
<span class="boring">}
</span></code></pre></pre>
<p>Here, we are not calling <code>test_fn</code>, just taking its value.</p>
<h2 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h2>
<h3 id="allow-users-to-the-values-for-impl-traits-but-do-not-require-it"><a class="header" href="#allow-users-to-the-values-for-impl-traits-but-do-not-require-it">Allow users to the values for impl Traits, but do not require it</a></h3>
<h3 id=""><a class="header" href="#"></a></h3>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../evaluation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../explainer.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../evaluation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../explainer.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
